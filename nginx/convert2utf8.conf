# Convert2UTF8 前端容器代理
location /convert/ {
    # 移除 /convert 前缀，转发到前端容器
    rewrite ^/convert/(.*) /$1 break;
    
    # 代理头设置
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Forwarded-Host $host;
    proxy_set_header X-Forwarded-Port $server_port;
    
    # 超时设置
    proxy_connect_timeout 60s;
    proxy_send_timeout 60s;
    proxy_read_timeout 60s;
    
    # 缓冲设置
    proxy_buffering on;
    proxy_buffer_size 4k;
    proxy_buffers 8 4k;
    
    # 转发到前端容器
    proxy_pass http://convert2utf8-frontend:80/;
    
    # 错误处理
    proxy_intercept_errors on;
    error_page 502 503 504 /50x.html;
}

# Convert2UTF8 API代理
location /convert/api/ {
    rewrite ^/convert/api/(.*) /api/$1 break;
    
    # 代理头设置
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Forwarded-Host $host;
    proxy_set_header X-Forwarded-Port $server_port;
    
    # 文件上传大小限制
    client_max_body_size 50M;
    
    # 超时设置
    proxy_connect_timeout 60s;
    proxy_send_timeout 60s;
    proxy_read_timeout 60s;
    
    # 缓冲设置
    proxy_buffering on;
    proxy_buffer_size 4k;
    proxy_buffers 8 4k;
    
    # 转发到后端容器
    proxy_pass http://convert2utf8-backend:3001/;
    
    # 错误处理
    proxy_intercept_errors on;
    error_page 502 503 504 /50x.html;
} 